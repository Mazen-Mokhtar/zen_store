# ربط صفحة الـ Packages بالـ Backend

## نظرة عامة
تم ربط صفحة الـ packages بالـ backend بنجاح. الآن عندما يختار المستخدم لعبة من صفحة الألعاب، سيتم توجيهه إلى صفحة الـ packages الخاصة بتلك اللعبة.

## التغييرات المطبقة

### 1. تحديث API Service (`lib/api.ts`)
- إضافة interface جديد للـ `Package`
- إضافة دالة `getPackagesByGameId()` لجلب الباقات حسب الـ gameId
- إضافة دالة `getGameById()` لجلب معلومات اللعبة

### 2. تحديث صفحة Dashboard (`app/dashboard/page.tsx`)
- إضافة `useRouter` للتنقل
- إضافة `handleGameClick()` للانتقال إلى صفحة الـ packages عند النقر على اللعبة
- تمرير `gameId` و `gameName` كـ URL parameters

### 3. تحديث صفحة Packages (`app/packages/page.tsx`)
- إضافة `useSearchParams` لقراءة الـ URL parameters
- إضافة state management للـ packages والـ game
- إضافة loading و error states
- جلب البيانات من الـ backend بدلاً من البيانات الثابتة
- عرض رسالة في حالة عدم وجود باقات
- تحديث عرض البيانات لتتناسب مع schema الـ backend الجديد

## كيفية الاستخدام

### 1. من صفحة الألعاب
1. انتقل إلى `/dashboard` أو `/dashboard?category=categoryId`
2. انقر على أي لعبة من قائمة الألعاب
3. سيتم توجيهك تلقائياً إلى `/packages?gameId=gameId`

### 2. الوصول المباشر
يمكن الوصول مباشرة إلى صفحة الـ packages عبر:
```
/packages?gameId=gameId
```

## API Endpoints المستخدمة

### جلب الباقات حسب اللعبة
```
GET /packages?gameId={gameId}
```

### جلب معلومات اللعبة
```
GET /game/{gameId}
```

## معالجة الأخطاء

### 1. عدم وجود gameId
- عرض رسالة خطأ مع زر للعودة للرئيسية

### 2. فشل في جلب البيانات
- عرض رسالة خطأ مع إمكانية إعادة المحاولة

### 3. عدم وجود باقات
- عرض رسالة "لا توجد باقات متاحة لهذه اللعبة"

## الميزات الجديدة

1. **جلب البيانات الديناميكية**: الباقات تُجلب من الـ backend حسب اللعبة المختارة
2. **عرض معلومات اللعبة**: صورة ووصف اللعبة تُعرض في الجانب الأيمن
3. **معالجة الحالات المختلفة**: loading, error, empty states
4. **التنقل السلس**: انتقال سلس من صفحة الألعاب إلى صفحة الباقات
5. **تصميم الكروت المحسن**: كروت ذهبية مع تأثيرات بصرية جذابة

## تحديثات تصميم الكروت

### الأنماط المطبقة:
- **خلفية ذهبية**: gradient ذهبي مع تأثيرات بصرية
- **تأثيرات hover**: رفع الكرت مع ظل ذهبي
- **تأثيرات التحديد**: حدود خضراء عند التحديد
- **ظلال النص**: تأثيرات ظل للنصوص والأسعار
- **تصميم متجاوب**: يعمل على جميع أحجام الشاشات

### الألوان المستخدمة:
- **الخلفية**: `linear-gradient(71deg, #080509, #1a171c, #080509)`
- **الحدود الذهبية**: `linear-gradient(71deg, #ffee24, #f9f047, #ffee24)`
- **السعر**: `#ffee24` (ذهبي)
- **النص**: `white` و `hsla(0,0%,100%,0.6)`
- **التحديد**: `#00e6c0` (أخضر)

## تحديثات البيانات

### الحقول الجديدة المستخدمة:
- **title**: عنوان الباقة (مثل "100 Diamonds", "500 Coins")
- **price**: السعر الأساسي للباقة
- **finalPrice**: السعر النهائي بعد الخصم
- **originalPrice**: السعر الأصلي قبل الخصم
- **discountPercentage**: نسبة الخصم
- **isOffer**: هل الباقة عرض خاص
- **currency**: العملة (EGP, USD, إلخ)
- **image**: صورة الباقة

### معالجة البيانات:
- عرض السعر النهائي إذا كان متوفر، وإلا السعر الأساسي
- عرض السعر الأصلي فقط إذا كان أكبر من السعر النهائي
- عرض نسبة الخصم فقط إذا كانت أكبر من 0
- عرض "عرض خاص" في الوصف إذا كانت الباقة عرض
- تنسيق الأرقام باستخدام `toLocaleString()`

## ملاحظات تقنية

- يتم استخدام `useEffect` لجلب البيانات عند تحميل الصفحة
- يتم استخدام `useSearchParams` لقراءة الـ URL parameters
- يتم استخدام `useRouter` للتنقل بين الصفحات
- تم إضافة error boundaries و loading states لتحسين تجربة المستخدم

## حل مشاكل الـ Hydration

### المشكلة
قد تظهر أخطاء hydration بسبب:
- تضارب بين الـ server-side rendering والـ client-side rendering
- استخدام `ThemeProvider` في أكثر من layout
- تغيير البيانات بين الـ server والـ client

### الحلول المطبقة
1. **إزالة `<html>` و `<body>` من packages layout**: تم نقل هذه العناصر إلى الـ root layout فقط
2. **إضافة `suppressHydrationWarning`**: لتجنب تحذيرات hydration غير الضرورية
3. **فحص `typeof window`**: للتأكد من أن الكود يعمل في المتصفح فقط
4. **إضافة `unoptimized` للصور**: لتجنب مشاكل تحسين الصور

### كيفية تجنب مشاكل الـ Hydration
- استخدم `useEffect` للكود الذي يعمل فقط في المتصفح
- تأكد من أن البيانات متسقة بين الـ server والـ client
- استخدم `suppressHydrationWarning` بحذر فقط عند الضرورة